kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    # Resource configuration:
    # Note: Actual CPU/memory limits are controlled by Docker Desktop settings.
    # Ensure Docker Desktop has at least 6 CPUs and 10GB memory allocated.
    # On macOS: Docker Desktop → Settings → Resources → Advanced
    # The node will use resources available from Docker Desktop.
    # Map NodePorts from the kind node out to your host so you can use localhost.
    extraPortMappings:
      # Grafana Service (NodePort 30080) → http://localhost:30080
      - containerPort: 30080
        hostPort: 30080
        protocol: TCP
      # Orchestrator Service (NodePort 30081) → http://localhost:30081
      - containerPort: 30081
        hostPort: 30081
        protocol: TCP
      # Spark Master UI (NodePort 30082) → http://localhost:30082
      - containerPort: 30082
        hostPort: 30082
        protocol: TCP
      # Spark Worker UI (NodePort 30083) → http://localhost:30083
      - containerPort: 30083
        hostPort: 30083
        protocol: TCP
      # Vector OTLP HTTP (NodePort 30418) → http://localhost:30418
      - containerPort: 30418
        hostPort: 30418
        protocol: TCP
    # Configure kubelet to allow metrics-server access
    # This fixes the 403 Forbidden error when metrics-server tries to scrape node metrics
    kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            authorization-mode: AlwaysAllow
            anonymous-auth: "true"
      - |
        kind: JoinConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            authorization-mode: AlwaysAllow
            anonymous-auth: "true"


